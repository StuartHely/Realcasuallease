apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: myapp-deployment\n  labels:\n    app: myapp\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: myapp\n  template:\n    metadata:\n      labels:\n        app: myapp\n    spec:\n      containers:\n      - name: myapp-container\n        image: myapp:latest\n        ports:\n        - containerPort: 80\n        env:\n        - name: DATABASE_URL\n          valueFrom:\n            secretKeyRef:\n              name: postgres-secret\n              key: database_url\n        - name: POSTGRES_USER\n          valueFrom:\n            secretKeyRef:\n              name: postgres-secret\n              key: postgres_user\n        - name: POSTGRES_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: postgres-secret\n              key: postgres_password\n        livenessProbe:\n          httpGet:\n            path: /health\n            port: 80\n          initialDelaySeconds: 30\n          periodSeconds: 10\n        readinessProbe:\n          httpGet:\n            path: /ready\n            port: 80\n          initialDelaySeconds: 5\n          periodSeconds: 10\n        securityContext:\n          runAsUser: 1001\n          runAsGroup: 3001\n          fsGroup: 2001\n        resources:\n          requests:\n            memory: "256Mi"\n            cpu: "500m"\n          limits:\n            memory: "512Mi"\n            cpu: "1"\n      \n      # Configure Horizontal Pod Autoscaler\n      minReplicas: 2\n      maxReplicas: 5\n      metrics:\n      - type: Resource\n        resource:\n          name: cpu\n          target:\n            type: Utilization\n            averageUtilization: 80\n\n